const source = new EventSource("/events"); source.addEventListener("log", function (t) { const n = document.getElementById("log"); let e = ""; t.data.startsWith("[1;31m") ? e = "e" : t.data.startsWith("[0;33m") ? e = "w" : t.data.startsWith("[0;32m") ? e = "i" : t.data.startsWith("[0;35m") ? e = "c" : t.data.startsWith("[0;36m") ? e = "d" : t.data.startsWith("[0;37m") ? e = "v" : n.innerHTML += t.data + "\n", n.innerHTML += '<span class="' + e + '">' + t.data.substr(7, t.data.length - 10) + "</span>\n" }), source.addEventListener("state", function (t) { const n = JSON.parse(t.data); console.log("got state", t); const e = t => document.getElementById(t.id).children[1].innerText = t.state; Array.isArray(n) ? n.forEach(t => e(t)) : e(n) }); const states = document.getElementById("states"); let row, i = 0; for (; row = states.rows[i]; i++)row.classList.contains("switch") && function (t) { row.children[2].children[0].addEventListener("click", function () { const n = new XMLHttpRequest; n.open("POST", "/switch/" + t.substr(7) + "/toggle", !0), n.send() }) }(row.id), row.classList.contains("fan") && function (t) { row.children[2].children[0].addEventListener("click", function () { const n = new XMLHttpRequest; n.open("POST", "/fan/" + t.substr(4) + "/toggle", !0), n.send() }) }(row.id), row.classList.contains("light") && function (t) { row.children[2].children[0].addEventListener("click", function () { const n = new XMLHttpRequest; n.open("POST", "/light/" + t.substr(6) + "/toggle", !0), n.send() }) }(row.id), row.classList.contains("cover") && function (t) { row.children[2].children[0].addEventListener("click", function () { const n = new XMLHttpRequest; n.open("POST", "/cover/" + t.substr(6) + "/open", !0), n.send() }), row.children[2].children[1].addEventListener("click", function () { const n = new XMLHttpRequest; n.open("POST", "/cover/" + t.substr(6) + "/close", !0), n.send() }) }(row.id);